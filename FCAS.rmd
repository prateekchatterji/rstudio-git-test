---
title: "Amtrack Ridership Forecasting"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

**Amtrak**, a US railway company, routinely collects data on ridership. This is a subjective exercise
built on series of monthly Amtrak ridership between January 1991 and
March 2004 in the United States.

Data is in public domain
[here](https://docs.google.com/open?id=0B76mgCvz1US5Z1lGRkZQZ1pRLTQ).

## Process

The Forecasting Process that we undertake is noted as follows:

![Forecasting Process](C:/Users/Administrator/Downloads/ForecastingProcess.png)

Forecasting Process

## Goals

1.  Forecast monthly user ridership on its trains for the purpose of Pricing.
    Using demand data to determine Pricing is called "revenue management" and is
    a popular practice by airlines and hotel chains. It is a Predictive Goal.

2.  Impact Assessment: Evaluating the effect of an event on the timeline such as
    Airport closure due to inclement weather, or the opening on new large
    national highway. This goal is retrospective in nature, and is therefore
    descriptive or even explanatory. Analysis would compare the series before
    and after the event, with no direct interest in future values of the series.
    Note that these goals are also geography specific and would therefore
    require using ridership data at a finer level of geography within United
    States.

3.  Identifying and quantifying Demand during different seasons for planning the
    number and frequency of trains needed during different seasons. If the model
    is only aimed at producing monthly indexes of demand, then it is a
    descriptive goal. In contrast, if the model will be used to forecast
    seasonal demand for future years then it is a predictive task.

4.  Finally, the Amtrack ridership data may be used by national agencies, such
    as Bureau of Transport Statistics to evaluate trends in transportation modes
    over the years. Whether it is descriptive or predictive goal depends on what
    the analysis will be used for. If it is used for the purpose of reporting
    past trends, then it is descriptive. If the purpose is forecasting future
    trends, then it is predictive goal.

### Forecast Horizon

Forecast Horizon is the *k* number of periods ahead that we must forecast, and
$F_{t+k}$ is a *k*-step-ahead forecast. In Amtrack ridership example, one month ahead
forecast $F_{t+1}$ mightbe sufficient for Revenue management for creating flexible
pricing. Whereas longer term forecasts, such as three month ahead forecast
$F_{t+3}$ are more likely to be needed for scheduling and procurement purpose.

### Forecast Updating

Timeliness of data collection and transfer directly affect the forecast horizon.
Whether improving the timeliness of data collection and transfer is possible or
not, its implications on forecasting must be recognized at goal definition
stage. Refreshing of forecasts based on new data is called *roll-forward
forecasting*.

### Forecast Use

Understanding how the forecast will be used, perhaps by different stakeholders,
is critical for generating forecasts of the right type and with a useful
accuracy level. Should the forecasts be binary(event/non-event)? Does
over-production cost more or less than under-production? Will the forecast be
used directly or will they be adjusted in some way before use? Will the forecast
be presented to management or to the Technical department? Answers to such
questions are necessary to choose appropriate data, methods and evaluation
schemes.


### Libraries

We will use [Rob J Hyndman's](https://robjhyndman.com/about/)
[forecast](https://www.rdocumentation.org/packages/forecast/versions/8.3)
package

```{r warning=FALSE, message=FALSE}
require(tidyverse) 
require(forecast)
require(xtable)
require(knitr)
require(zoo)
```
Different kinds of Forecasting

### Timeplot

A timeplot of monthly Amtrack ridership is shown in Figure 2.3. Observing the
plot reveals nature of time series components.

-   Values Scale: Thousands ofriders

-   Overall Level: 1,800,000 riders/month

-   Trend: Slight U-shaped

-   Seasonality: Pronounced, Annual, Peaks: July, August

Figure 2.3: Monthly ridership on AMtrack Trains (in thousands) from Jan 1991 to March 2004

```{r Amtrak Fig 2-3, echo=FALSE, warning=FALSE, message=FALSE}
Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991,1), end = c(2004, 3), freq = 12)

# Figure 2-3
plot(ridership.ts, xlab = "Time", ylab = "Ridership", ylim = c(1300, 2300), bty = "l")
```


### Trend and Zooming/Window

To fit a quadratic trend, run the forecast package's linear regression model for
time series, called tslm. The y value is ridership and two x values are trend
and square of trend. The function I treats square of trend as-is. Plot time
series and its fitted regression line in the top panel of figure 2.4 The bottom
panel shows a zoomed-in view of timeseries from January 1997 to December 2000.
Use the window function to identify a subset of time series.


```{r Amtrak Fig 2-6, echo=FALSE, warning=FALSE, message=FALSE}
library(forecast)

Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991,1), end = c(2004, 3), freq = 12)
ridership.lm <- tslm(ridership.ts ~ trend + I(trend^2))

# Figure 2-6
par(mfrow = c(2, 1))
plot(ridership.ts, xlab = "Time", ylab = "Ridership", ylim = c(1300, 2300), bty = "l", main = "Fitted Trend to Timeseries")
lines(ridership.lm$fitted, lwd = 2)
ridership.ts.zoom <- window(ridership.ts, start = c(1997, 1), end = c(2000, 12))
plot(ridership.ts.zoom, xlab = "Time", ylab = "Ridership", ylim = c(1300, 2300), bty = "l")

```

### Partitioning the Data

Temporal partitioning: Partitioning the data in Training and Validation period
is a linear process unlike that used in Cross sectional data which must be
randomly selected. A random selection on a timeline will cause a "hole". In the
same vein, a third partition - "test"- is not advised as the impact of recency
on forecasting is much higher. The latest partition, if made, will affect the
forecasting detrimentally. Finally, the last difference is that in Time series,
Training and Validation dataset are recombined before attempting to forecast
future values.

Define the number of months of training and validation datasets, `nValid` and
`nTrain`, respectively. Use the `time` and `window` function to create the
training and validation sets. Fit a model (here, a linear regression model) to
the training set. Use the `forecast` function to make predictions of time series
in the validation period. Plot the predictions.

```{r Amtrak Fig 3-1, echo=FALSE, warning=FALSE, message=FALSE}
library(forecast)

Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991, 1), end = c(2004, 3), freq = 12)

# Figure 3-1
plot(ridership.ts, ylim = c(1300, 2600),  ylab = "Ridership", xlab = "Time", bty = "l", xaxt = "n", xlim = c(1991,2006.25))
axis(1, at = seq(1991, 2006, 1), labels = format(seq(1991, 2006, 1), digits = 2))
lines(c(2004.25 - 3 , 2004.25 - 3), c(0, 3500))
lines(c(2004.25, 2004.25), c(0, 3500))
text(1996.25, 2500, "Training")
text(2002.75, 2500, "Validation")
text(2005.25, 2500, "Future")
arrows(2004 - 3,2450,1991.25,2450,code=3,length=0.1,lwd=1,angle=30)
arrows(2004.5 - 3,2450,2004,2450,code=3,length=0.1,lwd=1,angle=30)
arrows(2004.5,2450,2006,2450,code=3,length=0.1,lwd=1,angle=30)

```


```{r Amtrak Fig 3-2, echo=FALSE, warning=FALSE, message=FALSE}
library(forecast)
Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991, 1), end = c(2004, 3), freq = 12)

stepsAhead <- 36
nTrain <- length(ridership.ts) - stepsAhead
train.ts <- window(ridership.ts, start = c(1991, 1), end = c(1991, nTrain))
valid.ts <- window(ridership.ts, start = c(1991, nTrain + 1), end = c(1991, nTrain + stepsAhead))
ridership.lm <-  tslm(train.ts ~ trend + I(trend^2))
ridership.lm.pred <- forecast(ridership.lm, h = stepsAhead, level = 0)

# Figure 3-2
plot(ridership.lm.pred, ylim = c(1300, 2600),  ylab = "Ridership", xlab = "Time", bty = "l", xaxt = "n", xlim = c(1991,2006.25), main = "", flty = 2)
axis(1, at = seq(1991, 2006, 1), labels = format(seq(1991, 2006, 1))) 
lines(ridership.lm$fitted, lwd = 2)
lines(valid.ts)
lines(c(2004.25 - 3, 2004.25 - 3), c(0, 3500)) 
lines(c(2004.25, 2004.25), c(0, 3500))
text(1996.25, 2500, "Training")
text(2002.75, 2500, "Validation")
text(2005.25, 2500, "Future")
arrows(2004 - 3, 2450, 1991.25, 2450, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5 - 3, 2450, 2004, 2450, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5, 2450, 2006, 2450, code = 3, length = 0.1, lwd = 1, angle = 30)
```
### Computing Predictive Measures

-   Forecast Error/ Residual

-   MAE/MAD

-   Average Error

-   MAPE

-   RMSE

-   Zero Counts affecting MAPE

-   MASE

-   Forecast accuracy vs Profitability: Balancing the cost and perspective of
    Type One and Type Two Errors
    
```{r Amtrak Table 3.0, echo=FALSE, warning=FALSE, message=FALSE}
accuracy(ridership.lm.pred$mean, valid.ts)
```
### Residuals

Use the `names` function to fund out which elements are included with the
`forecast` object called `ridership.lm.pred`. The model's residuals are forecast
error in training period. Subtracting the model's `mean` (or forecasts) from
`valid.ts` (or actuals) in the validation period gives the forecast error in the
validation period.
```{r Amtrak Fig 3-3, echo=FALSE, warning=FALSE, message=FALSE}
library(forecast)

Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991, 1), end = c(2004, 3), freq = 12)

stepsAhead <- 36
nTrain <- length(ridership.ts) - stepsAhead
train.ts <- window(ridership.ts, start = c(1991, 1), end = c(1991, nTrain))
valid.ts <- window(ridership.ts, start = c(1991, nTrain + 1), end = c(1991, nTrain + stepsAhead))
ridership.lm <-  tslm(train.ts ~ trend + I(trend^2))
ridership.lm.pred <- forecast(ridership.lm, h = stepsAhead, level = 0)

# Figure 3-3
plot(ridership.lm.pred$residuals, ylim = c(-400, 500),  ylab = "Residuals", xlab = "Time", bty = "l", xaxt = "n", xlim = c(1991,2006.25), main = "")
axis(1, at = seq(1991, 2006, 1), labels = format(seq(1991, 2006, 1)))
lines(valid.ts - ridership.lm.pred$mean, lwd = 1)
lines(c(2004.25 - 3, 2004.25 - 3), c(-500, 3500))
lines(c(2004.25, 2004.25), c(-500, 3500))
text(1996.25, 500, "Training")
text(2002.75, 500, "Validation")
text(2005.25, 500, "Future")
arrows(2004 - 3, 450, 1991.25, 450, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5 - 3, 450, 2004, 450, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5, 450, 2006, 450, code = 3, length = 0.1, lwd = 1, angle = 30)
```

Figure 3.3: Timeplot of forecast errors (residuals) from a quadratic trend model
applied to the Amtrack ridership data.

Put the model's residuals into the `hist` function to plot the histogram of, or
frequency of forecast errors in each of seven (automatically and equally sized)
bins.


```{r Amtrak Fig 3-4, echo=FALSE, warning=FALSE, message=FALSE}
library(forecast)

Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991, 1), end = c(2004, 3), freq = 12)

stepsAhead <- 36
nTrain <- length(ridership.ts) - stepsAhead
train.ts <- window(ridership.ts, start = c(1991, 1), end = c(1991, nTrain))
valid.ts <- window(ridership.ts, start = c(1991, nTrain + 1), end = c(1991, nTrain + stepsAhead))
ridership.lm <-  tslm(train.ts ~ trend + I(trend^2))
ridership.lm.pred <- forecast(ridership.lm, h = stepsAhead, level = 0)
names(ridership.lm.pred)

# Figure 3-4
hist(ridership.lm.pred$residuals,  ylab = "Frequency", xlab = "Forecast Error", bty = "l", main = "")

```

Figure 3.4: Histogram of forecast errors in the Training period from a quadratic
trend model applied to the Amtrack ridership data.



Prediction Intervals: When errors are not normally distributed, forecast errors
can be obtained from the training period to construct a prediction interval in
the validation period and future. For example, a 95% prediction interval can be
constructed by using the 5th and 95th percentiles from the sample of forecast
errors.

```{r Amtrak Fig 3-5, echo=FALSE, warning=FALSE, message=FALSE}
library(forecast)

Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991, 1), end = c(2004, 3), freq = 12)

nValid <- 36
nTrain <- length(ridership.ts) - nValid
train.ts <- window(ridership.ts, start = c(1991, 1), end = c(1991, nTrain))
valid.ts <- window(ridership.ts, start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid))
ridership.lm <-  tslm(train.ts ~ trend + I(trend^2))
ridership.lm.pred <- forecast(ridership.lm, h = nValid, level = 95)

# Figure 3-5
plot(ridership.lm.pred, ylim = c(1300, 2600),  ylab = "Ridership", xlab = "Time", bty = "l", xaxt = "n", xlim = c(1991,2006.25), main = "", flty = 2)
axis(1, at = seq(1991, 2006, 1), labels = format(seq(1991, 2006, 1)))
lines(ridership.lm$fitted, lwd = 2)
lines(valid.ts)
lines(c(2004.25 - 3, 2004.25 - 3), c(0, 3500)) 
lines(c(2004.25, 2004.25), c(0, 3500))
text(1996.25, 2500, "Training")
text(2002.75, 2500, "Validation")
text(2005.25, 2500, "Future")
arrows(2004 - 3, 2450, 1991.25, 2450, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5 - 3, 2450, 2004, 2450, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5, 2450, 2006, 2450, code = 3, length = 0.1, lwd = 1, angle = 30)
```

Figure 3.5: Point forecasts and 95% prediction intervals in the validation
period gained from a quadratic trend model applied to the Amtrack ridership
data. (`level = 95`)



```{r Amtrak Fig 3-6, echo=FALSE, warning=FALSE, message=FALSE}
library(forecast)

Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991, 1), end = c(2004, 3), freq = 12)

fixed.nValid <- 36
fixed.nTrain <- length(ridership.ts) - fixed.nValid
train.ts <- window(ridership.ts, start = c(1991, 1), end = c(1991, fixed.nTrain))
valid.ts <- window(ridership.ts, start = c(1991, fixed.nTrain + 1), end = c(1991, fixed.nTrain + fixed.nValid))
naive.fixed <- naive(train.ts, h = fixed.nValid)
naive.roll <- ts(Amtrak.data$Ridership[fixed.nTrain:(fixed.nTrain + fixed.nValid - 1)], start = c(1991, fixed.nTrain + 1), end = c(1991, fixed.nTrain + fixed.nValid), freq = 12)

# Figure 3-6
plot(train.ts, ylim = c(1300, 2600),  ylab = "Ridership", xlab = "Time", bty = "l", xaxt = "n", xlim = c(1991,2006.25), main = "")
axis(1, at = seq(1991, 2006, 1), labels = format(seq(1991, 2006, 1)))
lines(naive.fixed$mean, lwd = 2, col = "blue", lty = 2)
lines(naive.roll, lwd = 2, col = "green", lty = 2)
lines(valid.ts)
lines(c(2004.25 - 3, 2004.25 - 3), c(0, 3500)) 
lines(c(2004.25, 2004.25), c(0, 3500))
text(1996.25, 2500, "Training")
text(2002.75, 2500, "Validation")
text(2005.25, 2500, "Future")
arrows(2004 - 3, 2450, 1991.25, 2450, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5 - 3, 2450, 2004, 2450, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5, 2450, 2006, 2450, code = 3, length = 0.1, lwd = 1, angle = 30)


```

Figure 3.7: Naïve forecasts using a fixed validation period (Dashed horizontal
line in blue) vs one-step-ahead Naïve forecasts using monthly roll-forward
validation period (other dashed line in green) for Amtrack ridership data. The
actual values are plotted with a smooth line.

```{r Amtrak Table 3-3, echo=FALSE, warning=FALSE, message=FALSE}
require(forecast)

Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991, 1), end = c(2004, 3), freq = 12)

fixed.nValid <- 36
fixed.nTrain <- length(ridership.ts) - fixed.nValid

stepsAhead <- 1
error <- rep(0, fixed.nValid -stepsAhead+1)
percent.error <- rep(0, fixed.nValid -stepsAhead+1)
for(j in fixed.nTrain:(fixed.nTrain+fixed.nValid-stepsAhead) ){
  train.ts <- window(ridership.ts, start = c(1991, 1), end = c(1991, j))
  valid.ts <- window(ridership.ts, start = c(1991,  j + stepsAhead), end = c(1991,  j + stepsAhead))
  naive.pred <- naive(train.ts, h = stepsAhead )
  error[j - fixed.nTrain + 1] <- valid.ts -naive.pred$mean[stepsAhead]
  percent.error[j - fixed.nTrain + 1] <- error[j - fixed.nTrain + 1]/valid.ts
}

mean(abs(error))
sqrt(mean(error^2))
mean(abs(percent.error))
```


```{r Amtrak Table 3-4 and 3-5, echo=FALSE, warning=FALSE, message=FALSE}

fixed.nValid <- 36
fixed.nTrain <- length(ridership.ts) - fixed.nValid

train.ts <- window(ridership.ts, start = c(1991, 1), end = c(1991, fixed.nTrain))
valid.ts <- window(ridership.ts, start = c(1991, fixed.nTrain + 1), 
                   end = c(1991, fixed.nTrain + fixed.nValid))
naive.pred <- naive(train.ts, h = fixed.nValid)
snaive.pred <- snaive(train.ts, h = fixed.nValid)
accuracy(naive.pred, valid.ts)
accuracy(snaive.pred, valid.ts)



# note to self
# These are mts objects == matrixed time series
# colnames, rownames 
# cbind, rbind


#glimpse(naive.pred)
table3_4 <- cbind(window(ridership.ts, start = c(2001, 4), end = c(2004, 3)),
                  window(naive.pred$mean, start = c(2001, 4), end = c(2004, 3)),
                  window(snaive.pred$mean, start = c(2001, 4), end = c(2004, 3))
                  ) 

colnames(table3_4) <- c("Actual", "Naive", "Seasonal Naive")
# kable(table3_4)

xtable(table3_4)
head(table3_4)


# # ts.intersect and ts.union can also be applicable.
# table3_4_1 <- ts.intersect(window(ridership.ts, start = c(2001, 4), end = c(2004, 3)),
#                   window(naive.pred$mean, start = c(2001, 4), end = c(2004, 3)),
#                   window(snaive.pred$mean, start = c(2001, 4), end = c(2004, 3)),
#                   dframe = FALSE)
# 
# colnames(table3_4_1) <- c("Actual", "Naive", "Seasonal Naive")
# kable(table3_4_1)
# 
# # zoo transformation to do the same work
# table3_4_2_1  <- as.zoo(window(ridership.ts, start = c(2001, 4), end = c(2004, 3)))
# table3_4_2_1
# table3_4_2_2  <- as.zoo(window(naive.pred$mean, start = c(2001, 4), end = c(2004, 3)))
# table3_4_2_3  <- as.zoo(window(snaive.pred$mean, start = c(2001, 4), end = c(2004, 3)))
#               
#                   
# table3_4_2 <- merge(table3_4_2_1, table3_4_2_2, table3_4_2_3)
# colnames(table3_4_2) <- c("Actual", "Naive", "Seasonal Naive")
# head(table3_4_2)


## Acuracy Calculations
na3_4 <-  accuracy(naive.pred, valid.ts)
sna3_4 <- accuracy(snaive.pred, valid.ts)


table3_5 <- rbind(na3_4[2,], sna3_4[2,colnames(na3_4)])
rownames(table3_5) <- c("Naive", "Seasonal Naive")
# table3_5

kable(table3_5[,2:6], caption = "Comparison of Accuracy Metrics")





```
Table 3.4: Naïve and season naïve forecasts for fixed validation period
(ridership data)

Table 3.5: Performance of naïve vs seasonal naïve forecasts using fixed
partitioning


# Smoothening 
```{r Amtrak Fig 5-2, echo=FALSE, warning=FALSE, message=FALSE}
library(forecast)
library(zoo)

Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991, 1), end = c(2004, 3), freq = 12)

ma.trailing <- rollmean(ridership.ts, k = 12, align = "right")
ma.centered <- ma(ridership.ts, order = 12)

# Figure 5-2
plot(ridership.ts, ylim = c(1300, 2200),  ylab = "Ridership", xlab = "Time", bty = "l", xaxt = "n", 
     xlim = c(1991,2004.25), main = "")
axis(1, at = seq(1991, 2004.25, 1), labels = format(seq(1991, 2004.25, 1)))
lines(ma.centered, lwd = 2)
lines(ma.trailing, lwd = 2, lty = 2)
legend(1994,2200, c("Ridership","Centered Moving Average", "Trailing Moving Average"), lty=c(1,1,2), lwd=c(1,2,2), bty = "n")  

```

```{r Amtrak Fig 5-3, echo=FALSE, warning=FALSE, message=FALSE}
library(forecast)
library(zoo)

Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991, 1), end = c(2004, 3), freq = 12)

nValid <- 36
nTrain <- length(ridership.ts) - nValid
train.ts <- window(ridership.ts, start = c(1991, 1), end = c(1991, nTrain))
valid.ts <- window(ridership.ts, start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid))
ma.trailing <- rollmean(train.ts, k = 12, align = "right")
last.ma <- tail(ma.trailing, 1)
ma.trailing.pred <- ts(rep(last.ma, nValid), start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid), freq = 12)

# Figure 5-3
plot(train.ts, ylim = c(1300, 2600),  ylab = "Ridership", xlab = "Time", bty = "l", xaxt = "n", xlim = c(1991,2006.25), main = "")
axis(1, at = seq(1991, 2006, 1), labels = format(seq(1991, 2006, 1)))
lines(ma.trailing, lwd = 2) 
lines(ma.trailing.pred, lwd = 2, col = "blue", lty = 2) 
lines(valid.ts)
lines(c(2004.25 - 3, 2004.25 - 3), c(0, 3500)) 
lines(c(2004.25, 2004.25), c(0, 3500))
text(1996.25, 2500, "Training")
text(2002.75, 2500, "Validation")
text(2005.25, 2500, "Future")
arrows(2004 - 3, 2450, 1991.25, 2450, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5 - 3, 2450, 2004, 2450, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5, 2450, 2006, 2450, code = 3, length = 0.1, lwd = 1, angle = 30)





```

```{r Amtrak Fig 5-4, echo=FALSE, warning=FALSE, message=FALSE}
library(forecast)
library(zoo)

Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991, 1), end = c(2004, 3), freq = 12)

# Figure 5-4
par(mfrow = c(2,2))
plot(ridership.ts, ylab = "Ridership", xlab = "Time", bty = "l", xlim = c(1991,2004.25), main = "Ridership")
plot(diff(ridership.ts, lag = 12), ylab = "Lag-12", xlab = "Time", bty = "l", xlim = c(1991,2004.25), main = "Lag-12 Difference")
plot(diff(ridership.ts, lag = 1), ylab = "Lag-1", xlab = "Time", bty = "l", xlim = c(1991,2004.25), main = "Lag-1 Difference")
plot(diff(diff(ridership.ts, lag = 12), lag = 1), ylab = "Lag-12, then Lag-1", xlab = "Time", bty = "l", xlim = c(1991,2004.25), main = "Twice-Differenced (Lag-12, Lag-1)")
dev.off()

ridership.deseasonalized <- diff(ridership.ts, lag = 12)
summary(tslm(ridership.deseasonalized ~ trend))

```

```{r Amtrak Fig 5-5 Tab 5-1, echo=FALSE, warning=FALSE, message=FALSE}
library(forecast)
library(zoo)

Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991, 1), end = c(2004, 3), freq = 12)

diff.twice.ts <- diff(diff(ridership.ts, lag = 12), lag = 1)
nValid <- 36
nTrain <- length(diff.twice.ts) - nValid
train.ts <- window(diff.twice.ts, start = c(1992, 2), end = c(1992, nTrain + 1))
valid.ts <- window(diff.twice.ts, start = c(1992, nTrain + 2), end = c(1992, nTrain + 1 + nValid))

ses <- ets(train.ts, model = "ANN", alpha = 0.2)
ses.pred <- forecast(ses, h = nValid, level = 0)

# Figure 5-5
plot(ses.pred, ylim = c(-250, 300),  ylab = "Ridership (Twice-Differenced)", xlab = "Time", bty = "l", xaxt = "n", xlim = c(1991,2006.25), main = "", flty = 2)
axis(1, at = seq(1991, 2006, 1), labels = format(seq(1991, 2006, 1)))
lines(ses.pred$fitted, lwd = 2, col = "blue")
lines(valid.ts)
lines(c(2004.25 - 3, 2004.25 - 3), c(-250, 350)) 
lines(c(2004.25, 2004.25), c(-250, 350))
text(1996.25, 275, "Training")
text(2002.75, 275, "Validation")
text(2005.25, 275, "Future")
arrows(2004 - 3, 245, 1991.5, 245, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5 - 3, 245, 2004, 245, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5, 245, 2006, 245, code = 3, length = 0.1, lwd = 1, angle = 30)
dev.off()


# Table 5.1
ses.opt <- ets(train.ts, model = "ANN")
ses.opt.pred <- forecast(ses.opt, h = nValid, level = 0)
ses.opt
accuracy(ses.pred, valid.ts)
accuracy(ses.opt.pred, valid.ts)


# Miscellaneous calculations below.
ar1 <- auto.arima(train.ts)
ar1
arima.pred <- forecast(ar1, h = nValid)

diff.once.ts <- diff(ridership.ts, lag = 12)
diff.df <- data.frame("Time" = as.vector(time(ridership.ts)), "None" = as.vector(ridership.ts), "Once" = c(rep(NA, 12), as.vector(diff.once.ts)), "Twice" = c(rep(NA, 13), as.vector(diff.twice.ts)), "Pred" = c(rep(NA, length(ridership.ts) - nValid), as.vector(ses.pred$mean)))

rts <- window(ridership.ts, start = c(1991, 1), end = c(1991, nTrain))
rets <- ets(rts)
rets
rets.pred <- forecast(rets, h = nValid)
plot(rets.pred)

initial.diff.once <- window(diff.once.ts, start = c(2001, 3), end = c(2001, 3))
once.pred <- as.vector(diffinv(arima.pred$mean, lag = 1, xi = initial.diff.once))
once.pred[2:37]
initial.values <- window(ridership.ts, start = c(2000, 4), end = c(2001, 3))
as.vector(diffinv(once.pred[2:37], lag = 12, xi = initial.values))
final.pred <- diffinv(once.pred[2:37], lag = 12, xi = initial.values)
final.pred[13:48]
accuracy(final.pred[13:48], ridership.ts[124:159])

ets(ridership.ts)$states

```


```{r Amtrak Fig 5-6 Tab 5-2 5-4 5-5, echo=FALSE, warning=FALSE, message=FALSE}
library(forecast)
library(zoo)

Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991, 1), end = c(2004, 3), freq = 12)

nValid <- 36
nTrain <- length(ridership.ts) - nValid
train.ts <- window(ridership.ts, start = c(1991, 1), end = c(1991, nTrain))
valid.ts <- window(ridership.ts, start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid))

hwin <- ets(train.ts, model = "MAA")
hwin.pred <- forecast(hwin, h = nValid, level = 0)

# Figure 5.6
plot(hwin.pred, ylim = c(1300, 2600),  ylab = "Ridership", xlab = "Time", bty = "l", xaxt = "n", xlim = c(1991,2006.25), main = "", flty = 2)
axis(1, at = seq(1991, 2006, 1), labels = format(seq(1991, 2006, 1)))
lines(hwin.pred$fitted, lwd = 2, col = "blue")
lines(valid.ts)
lines(c(2004.25 - 3, 2004.25 - 3), c(0, 3500)) 
lines(c(2004.25, 2004.25), c(0, 3500))
text(1996.25, 2500, "Training")
text(2002.75, 2500, "Validation")
text(2005.25, 2500, "Future")
arrows(2004 - 3, 2450, 1991.25, 2450, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5 - 3, 2450, 2004, 2450, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5, 2450, 2006, 2450, code = 3, length = 0.1, lwd = 1, angle = 30)

# Table 5.2
hwin
hwin$states[1, ]  # Initial states
hwin$states[nrow(hwin$states), ]  # Final states
hwin$states

# Table 5.4
ets.opt <- ets(train.ts, restrict = FALSE, allow.multiplicative.trend = TRUE)

# Table 5.5
ets.opt.pred <- forecast(ets.opt, h = nValid, level = 0)
plot(ets.opt.pred)
accuracy(hwin.pred, valid.ts)
accuracy(ets.opt.pred, valid.ts)



```


# Smoothening 
```{r Amtrak Fig 6-2 Tab 6-1, echo=FALSE, warning=FALSE, message=FALSE}
library(forecast)
library(zoo)

Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991, 1), end = c(2004, 3), freq = 12)

nValid <- 36
nTrain <- length(ridership.ts) - nValid
train.ts <- window(ridership.ts, start = c(1991, 1), end = c(1991, nTrain))
valid.ts <- window(ridership.ts, start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid))

train.lm <- tslm(train.ts ~ trend)

# Figure 6.2
plot(train.ts, xlab = "Time", ylab = "Ridership", ylim = c(1300, 2300), bty = "l")
lines(train.lm$fitted, lwd = 2)

# Table 6.1
summary(train.lm)

```
## Box-Cox Transformation
```{r Amtrak Fig 6-3 6-5, echo=FALSE, warning=FALSE, message=FALSE}
library(forecast)
library(zoo)

Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991, 1), end = c(2004, 3), freq = 12)

nValid <- 36
nTrain <- length(ridership.ts) - nValid
train.ts <- window(ridership.ts, start = c(1991, 1), end = c(1991, nTrain))
valid.ts <- window(ridership.ts, start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid))

train.lm.expo.trend <- tslm(train.ts ~ trend, lambda = 0)
train.lm.expo.trend.pred <- forecast(train.lm.expo.trend, h = nValid, level = 0)

train.lm.linear.trend <- tslm(train.ts ~ trend, lambda = 1)
train.lm.linear.trend.pred <- forecast(train.lm.linear.trend, h = nValid, level = 0)

# Figures 6-3/6-5
plot(train.lm.expo.trend.pred, ylim = c(1300, 2600),  ylab = "Ridership", xlab = "Time", bty = "l", xaxt = "n", xlim = c(1991,2006.25), main = "", flty = 2)
axis(1, at = seq(1991, 2006, 1), labels = format(seq(1991, 2006, 1)))
lines(train.lm.expo.trend.pred$fitted, lwd = 2, col = "blue")  # Added in 6-5
lines(train.lm.linear.trend.pred$fitted, lwd = 2, col = "black", lty = 3)
lines(train.lm.linear.trend.pred$mean, lwd = 2, col = "black", lty = 3)
lines(valid.ts)
lines(c(2004.25 - 3, 2004.25 - 3), c(0, 3500)) 
lines(c(2004.25, 2004.25), c(0, 3500))
text(1996.25, 2500, "Training")
text(2002.75, 2500, "Validation")
text(2005.25, 2500, "Future")
arrows(2004 - 3, 2450, 1991.25, 2450, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5 - 3, 2450, 2004, 2450, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5, 2450, 2006, 2450, code = 3, length = 0.1, lwd = 1, angle = 30)


BoxCox(train.ts, 0)

```
##  Smoothening with various Permuations of Interaction Terms

```{r Amtrak Tab 6-2, echo=FALSE, warning=FALSE, message=FALSE}
library(forecast)
library(zoo)

Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991, 1), end = c(2004, 3), freq = 12)

nValid <- 36
nTrain <- length(ridership.ts) - nValid
train.ts <- window(ridership.ts, start = c(1991, 1), end = c(1991, nTrain))
valid.ts <- window(ridership.ts, start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid))

train.lm.poly.trend <- tslm(train.ts ~ trend + I(trend^2))
summary(train.lm.poly.trend)



```

```{r Amtrak Tab 6-3 Fig 6-7 Tab 6-5, echo=FALSE, warning=FALSE, message=FALSE}
library(forecast)
library(zoo)

Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991, 1), end = c(2004, 3), freq = 12)

nValid <- 36
nTrain <- length(ridership.ts) - nValid
train.ts <- window(ridership.ts, start = c(1991, 1), end = c(1991, nTrain))
valid.ts <- window(ridership.ts, start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid))

# Table 6.3
train.lm.season <- tslm(train.ts ~ season)
summary(train.lm.season)
train.lm.season.pred <- forecast(train.lm.season, h = nValid, level = 0)

# Figure 6-7
par(mfrow = c(2,1))
plot(train.lm.season.pred, ylim = c(1300, 2625),  ylab = "Ridership", xlab = "Time", bty = "l", xaxt = "n", xlim = c(1991,2006.25), main = "", flty = 2)
axis(1, at = seq(1991, 2006, 1), labels = format(seq(1991, 2006, 1)))
lines(train.lm.season.pred$fitted, lwd = 2, col = "blue")
lines(valid.ts)
lines(c(2004.25 - 3, 2004.25 - 3), c(0, 3500)) 
lines(c(2004.25, 2004.25), c(0, 3500))
text(1996.25, 2600, "Training")
text(2002.75, 2600, "Validation")
text(2005.25, 2600, "Future")
arrows(2004 - 3, 2450, 1991.25, 2450, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5 - 3, 2450, 2004, 2450, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5, 2450, 2006, 2450, code = 3, length = 0.1, lwd = 1, angle = 30)

plot(train.lm.season.pred$residuals, ylim = c(-400, 550),  ylab = "Residuals", xlab = "Time", bty = "l", xaxt = "n", xlim = c(1991,2006.25), main = "")
axis(1, at = seq(1991, 2006, 1), labels = format(seq(1991, 2006, 1)))
lines(train.ts - train.lm.season.pred$fitted)
lines(valid.ts - train.lm.season.pred$mean)
lines(c(2004.25 - 3, 2004.25 - 3), c(-500, 3500))
lines(c(2004.25, 2004.25), c(-500, 3500))
text(1996.25, 525, "Training")
text(2002.75, 525, "Validation")
text(2005.25, 525, "Future")
arrows(2004 - 3, 425, 1991.25, 425, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5 - 3, 425, 2004, 425, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5, 425, 2006, 425, code = 3, length = 0.1, lwd = 1, angle = 30)


# Table 6.5
train.lm.trig <- tslm(train.ts ~ trend + I(sin(2*pi*trend/12)) + I(cos(2*pi*trend/12)))
train.lm.trig.pred <- forecast(train.lm.trig, h = nValid, level = 0)

plot(train.lm.trig.pred, ylim = c(1300, 2600),  ylab = "Ridership", xlab = "Time", bty = "l", xaxt = "n", xlim = c(1991,2006.25), main = "", flty = 2)
axis(1, at = seq(1991, 2006, 1), labels = format(seq(1991, 2006, 1)))
lines(train.lm.trig.pred$fitted, lwd = 2, col = "blue")
lines(valid.ts)
lines(c(2004.25 - 3, 2004.25 - 3), c(0, 3500)) 
lines(c(2004.25, 2004.25), c(0, 3500))
text(1996.25, 2500, "Training")
text(2002.75, 2500, "Validation")
text(2005.25, 2500, "Future")
arrows(2004 - 3, 2450, 1991.25, 2450, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5 - 3, 2450, 2004, 2450, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5, 2450, 2006, 2450, code = 3, length = 0.1, lwd = 1, angle = 30)

summary(train.lm.trig)

```

```{r Amtrak Tab 6-4 Fig 6-8, echo=FALSE, warning=FALSE, message=FALSE}
library(forecast)
library(zoo)

Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991, 1), end = c(2004, 3), freq = 12)

nValid <- 36
nTrain <- length(ridership.ts) - nValid
train.ts <- window(ridership.ts, start = c(1991, 1), end = c(1991, nTrain))
valid.ts <- window(ridership.ts, start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid))

train.lm.trend.season <- tslm(train.ts ~ trend + I(trend^2) + season)
train.lm.trend.season.pred <- forecast(train.lm.trend.season, h = nValid, level = 0)

# Table 6-4
summary(train.lm.trend.season)

# Figure 6-8
par(mfrow = c(2,1))
plot(train.lm.trend.season.pred, ylim = c(1300, 2625),  ylab = "Ridership", xlab = "Time", bty = "l", xaxt = "n", xlim = c(1991,2006.25), main = "", flty = 2)
axis(1, at = seq(1991, 2006, 1), labels = format(seq(1991, 2006, 1)))
lines(train.lm.trend.season.pred$fitted, lwd = 2, col = "blue")
lines(valid.ts)
lines(c(2004.25 - 3, 2004.25 - 3), c(0, 3500)) 
lines(c(2004.25, 2004.25), c(0, 3500))
text(1996.25, 2600, "Training")
text(2002.75, 2600, "Validation")
text(2005.25, 2600, "Future")
arrows(2004 - 3, 2450, 1991.25, 2450, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5 - 3, 2450, 2004, 2450, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5, 2450, 2006, 2450, code = 3, length = 0.1, lwd = 1, angle = 30)

plot(train.lm.trend.season.pred$residuals, ylim = c(-400, 550),  ylab = "Residuals", xlab = "Time", bty = "l", xaxt = "n", xlim = c(1991,2006.25), main = "")
axis(1, at = seq(1991, 2006, 1), labels = format(seq(1991, 2006, 1)))
lines(train.ts - train.lm.trend.season.pred$fitted)
lines(valid.ts - train.lm.trend.season.pred$mean)
lines(c(2004.25 - 3, 2004.25 - 3), c(-500, 3500))
lines(c(2004.25, 2004.25), c(-500, 3500))
text(1996.25, 525, "Training")
text(2002.75, 525, "Validation")
text(2005.25, 525, "Future")
arrows(2004 - 3, 425, 1991.25, 425, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5 - 3, 425, 2004, 425, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5, 425, 2006, 425, code = 3, length = 0.1, lwd = 1, angle = 30)
dev.off()

```

# Auto Correlations Plot and Treatment
```{r Amtrak Fig 6-11, echo=FALSE, warning=FALSE, message=FALSE}
library(forecast)
library(zoo)

Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991, 1), end = c(2004, 3), freq = 12)
ridership.24.ts <- window(ridership.ts, start = c(1991, 1), end = c(1991, 24))

# Figure 6-11
Acf(ridership.24.ts, lag.max = 12, main = "")


```
### Accounitng for Seasonality and Autocorrelation

```{r Amtrak Fig 6-12, echo=FALSE, warning=FALSE, message=FALSE}
library(forecast)
library(zoo)

Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991, 1), end = c(2004, 3), freq = 12)

nValid <- 36
nTrain <- length(ridership.ts) - nValid
train.ts <- window(ridership.ts, start = c(1991, 1), end = c(1991, nTrain))
valid.ts <- window(ridership.ts, start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid))

train.lm.trend.season <- tslm(train.ts ~ trend + I(trend^2) + season)

# Figure 6-12
Acf(train.lm.trend.season$residuals, lag.max = 12, main = "")

Acf(train.lm.trend.season$residuals, lag.max = 12, main = "")$acf
# At lag-1 the acf is 0.60405883.
```


```{r Amtrak Fig 6-13 Fig 6-14, echo=FALSE, warning=FALSE, message=FALSE}
library(forecast)
library(zoo)

Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991, 1), end = c(2004, 3), freq = 12)

nValid <- 36
nTrain <- length(ridership.ts) - nValid
train.ts <- window(ridership.ts, start = c(1991, 1), end = c(1991, nTrain))
valid.ts <- window(ridership.ts, start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid))

train.lm.trend.season <- tslm(train.ts ~ trend + I(trend^2) + season)
train.res.arima <- Arima(train.lm.trend.season$residuals, order = c(1,0,0))
train.res.arima.pred <- forecast(train.res.arima, h = nValid)

# Figure 6-13
plot(train.lm.trend.season$residuals, ylim = c(-250, 250),  ylab = "Residuals", 
     xlab = "Time", bty = "l", xaxt = "n", xlim = c(1991,2006.25), main = "")
axis(1, at = seq(1991, 2006, 1), labels = format(seq(1991, 2006, 1)))
lines(train.res.arima.pred$fitted, lwd = 2, col = "blue")
lines(c(2004.25 - 3, 2004.25 - 3), c(-500, 3500))
lines(c(2004.25, 2004.25), c(-500, 3500))
text(1996.25, 225, "Training")
text(2002.75, 225, "Validation")
text(2005.25, 225, "Future")
arrows(2004 - 3, 200, 1991.25, 200, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5 - 3, 200, 2004, 200, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5, 200, 2006, 200, code = 3, length = 0.1, lwd = 1, angle = 30)
dev.off()

summary(train.res.arima)

# Figure 6-14
Acf(train.res.arima$residuals, lag.max = 12, main = "")

```

### Fitting Neural Nets to forecasting

```{r Amtrak Fig 7-7, echo=FALSE, warning=FALSE, message=FALSE}
library(forecast)  

Amtrak.data <- read.csv("Amtrak data.csv")
ridership.ts <- ts(Amtrak.data$Ridership, start = c(1991, 1), end = c(2004, 3), freq = 12)
length(ridership.ts)
nValid <- 36
nTrain <- length(ridership.ts) - nValid
train.ts <- window(ridership.ts, start = c(1991, 1), end = c(1991, nTrain))
valid.ts <- window(ridership.ts, start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid))

set.seed(201)
ridership.nnetar <- nnetar(train.ts, repeats = 20, p = 11, P = 1, size = 7)
summary(ridership.nnetar$model[[1]])
ridership.nnetar.pred <- forecast(ridership.nnetar, h = nValid)
accuracy(ridership.nnetar.pred, valid.ts)

# Figure 7-7
plot(train.ts, ylim = c(1300, 2900),  ylab = "Ridership", xlab = "Time", bty = "l", xaxt = "n", xlim = c(1991,2006.25), lty = 1)
axis(1, at = seq(1991, 2006, 1), labels = format(seq(1991, 2006, 1)))
lines(ridership.nnetar.pred$fitted, lwd = 2, col = "blue")
lines(ridership.nnetar.pred$mean, lwd = 2, col = "blue", lty = 2)
lines(valid.ts)
lines(c(2004.25 - 3, 2004.25 - 3), c(0, 3500)) 
lines(c(2004.25, 2004.25), c(0, 3500))
text(1996.25, 2850, "Training")
text(2002.75, 2850, "Validation")
text(2005.25, 2850, "Future")
arrows(2004 - 3, 2700, 1991.25, 2700, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5 - 3, 2700, 2004, 2700, code = 3, length = 0.1, lwd = 1,angle = 30)
arrows(2004.5, 2700, 2006, 2700, code = 3, length = 0.1, lwd = 1, angle = 30)

ridership.nnetar.opt <- nnetar(train.ts)
ridership.nnetar.opt
ridership.nnetar.opt.pred <- forecast(ridership.nnetar.opt, h = nValid)
accuracy(ridership.nnetar.opt.pred, valid.ts)

```








```{r, echo=FALSE, warning=FALSE, message=FALSE, eval=FALSE}
# * "Amtrak Fig 2-3.R"
# * "Amtrak Fig 2-6.R"
# * "Amtrak Fig 3-1.R"
# * "Amtrak Fig 3-2.R"
# * "Amtrak Fig 3-3.R"
# * "Amtrak Fig 3-4.R"
# * "Amtrak Fig 3-5.R"
# * "Amtrak Fig 3-6.R"
# * "Amtrak Fig 5-2.R"
# * "Amtrak Fig 5-3.R"
# * "Amtrak Fig 5-4.R"
# * "Amtrak Fig 5-5, Tab 5-1.R"
# * "Amtrak Fig 5-6, Tab 5-2, 5-4, 5-5.R"
# * "Amtrak Fig 6-2, Tab 6-1.R"
# * "Amtrak Fig 6-3, 6-5.R"
# * "Amtrak Fig 6-11.R"
# * "Amtrak Fig 6-12.R"
# * "Amtrak Fig 6-13, Fig 6-14.R"
# * "Amtrak Fig 7-7.R"
# * "Amtrak Tab 6-2.R"
# * "Amtrak Tab 6-3, Fig 6-7, Tab 6-5.R"
# * "Amtrak Tab 6-4, Fig 6-8.R"
```

















